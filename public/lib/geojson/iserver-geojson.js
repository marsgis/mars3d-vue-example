!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).iserverGeojson={})}(this,function(t){"use strict";let e={startsWith:function(t,e){return 0==t.indexOf(e)},contains:function(t,e){return-1!=t.indexOf(e)},trim:function(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(t){const e=t.split("-");let n=e[0];for(let t=1,o=e.length;t<o;t++){const o=e[t];n+=o.charAt(0).toUpperCase()+o.substring(1)}return n},format:function(t,n,o){n||(n=window);return t.replace(e.tokenRegEx,function(t,e){let r;const s=e.split(/\.+/);for(let t=0;t<s.length;t++)0==t&&(r=n),r=r[s[t]];return"function"==typeof r&&(r=o?r.apply(null,o):r()),void 0===r?"undefined":r})},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(t){return e.numberRegEx.test(t)},numericIf:function(t){return e.isNumeric(t)?parseFloat(t):t}},n={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(t,e){let n=0;return e>0&&(n=parseFloat(t.toPrecision(e))),n},format:function(t,e,o,r){e=void 0!==e?e:0,o=void 0!==o?o:n.thousandsSeparator,r=void 0!==r?r:n.decimalSeparator,null!=e&&(t=parseFloat(t.toFixed(e)));const s=t.toString().split(".");1===s.length&&null==e&&(e=0);let i,l=s[0];if(o){const t=/(-?[0-9]+)([0-9]{3})/;for(;t.test(l);)l=l.replace(t,"$1"+o+"$2")}if(0==e)i=l;else{let t=s.length>1?s[1]:"0";null!=e&&(t+=new Array(e-t.length+1).join("0")),i=l+r+t}return i}};Number.prototype.limitSigDigs||(Number.prototype.limitSigDigs=function(t){return n.limitSigDigs(this,t)});class o{constructor(){this.CLASS_NAME="SuperMap.Geometry",this.id=i.createUniqueID(this.CLASS_NAME+"_"),this.parent=null,this.bounds=null,this.SRID=null}destroy(){this.id=null,this.bounds=null,this.SRID=null}clone(){return new o}setBounds(t){t&&(this.bounds=t.clone())}clearBounds(){this.bounds=null,this.parent&&this.parent.clearBounds()}extendBounds(t){this.getBounds()?this.bounds.extend(t):this.setBounds(t)}getBounds(){return null==this.bounds&&this.calculateBounds(),this.bounds}calculateBounds(){}getVertices(t){}getArea(){return 0}}const r=function(){let t,e="",n="",o="pc";const r=navigator.userAgent.toLowerCase();return r.indexOf("msie")>-1||r.indexOf("trident")>-1&&r.indexOf("rv")>-1?(e="msie",t=r.match(/msie ([\d.]+)/)||r.match(/rv:([\d.]+)/)):r.indexOf("chrome")>-1?(e="chrome",t=r.match(/chrome\/([\d.]+)/)):r.indexOf("firefox")>-1?(e="firefox",t=r.match(/firefox\/([\d.]+)/)):r.indexOf("opera")>-1?(e="opera",t=r.match(/version\/([\d.]+)/)):r.indexOf("safari")>-1&&(e="safari",t=r.match(/version\/([\d.]+)/)),n=t?t[1]:"",r.indexOf("ipad")>-1||r.indexOf("ipod")>-1||r.indexOf("iphone")>-1?o="apple":r.indexOf("android")>-1&&(t=r.match(/version\/([\d.]+)/),n=t?t[1]:"",o="android"),{name:e,version:n,device:o}}(),s=function(){let t=!0;const e=r;return document.createElement("canvas").getContext?("firefox"===e.name&&parseFloat(e.version)<5&&(t=!1),"safari"===e.name&&parseFloat(e.version)<4&&(t=!1),"opera"===e.name&&parseFloat(e.version)<10&&(t=!1),"msie"===e.name&&parseFloat(e.version)<9&&(t=!1)):t=!1,t}();!function(){const t=navigator.userAgent.toLowerCase();-1===t.indexOf("webkit")&&t.indexOf("gecko")}();const i={extend:function(t,e){if(t=t||{},e){for(const n in e){const o=e[n];void 0!==o&&(t[n]=o)}!("function"==typeof window.Event&&e instanceof window.Event)&&e.hasOwnProperty&&e.hasOwnProperty("toString")&&(t.toString=e.toString)}return t},copy:function(t,e){let n;if(t=t||{},e)for(const o in t)n=e[o],void 0!==n&&(t[o]=n)},reset:function(t){t=t||{};for(const e in t)if(t.hasOwnProperty(e)){if("object"==typeof t[e]&&t[e]instanceof Array){for(const n in t[e])t[e][n].destroy&&t[e][n].destroy();t[e].length=0}else"object"==typeof t[e]&&t[e]instanceof Object&&t[e].destroy&&t[e].destroy();t[e]=null}},getElement:function(){const t=[];for(let e=0,n=arguments.length;e<n;e++){let n=arguments[e];if("string"==typeof n&&(n=document.getElementById(n)),1===arguments.length)return n;t.push(n)}return t},isElement:function(t){return!(!t||1!==t.nodeType)},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},removeItem:function(t,e){for(let n=t.length-1;n>=0;n--)t[n]===e&&t.splice(n,1);return t},indexOf:function(t,e){if(null==t)return-1;if("function"==typeof t.indexOf)return t.indexOf(e);for(let n=0,o=t.length;n<o;n++)if(t[n]===e)return n;return-1},modifyDOMElement:function(t,e,n,o,r,s,i,l){e&&(t.id=e),n&&(t.style.left=n.x+"px",t.style.top=n.y+"px"),o&&(t.style.width=o.w+"px",t.style.height=o.h+"px"),r&&(t.style.position=r),s&&(t.style.border=s),i&&(t.style.overflow=i),parseFloat(l)>=0&&parseFloat(l)<1?(t.style.filter="alpha(opacity="+100*l+")",t.style.opacity=l):1===parseFloat(l)&&(t.style.filter="",t.style.opacity="")},applyDefaults:function(t,e){t=t||{};const n="function"==typeof window.Event&&e instanceof window.Event;for(const o in e)(void 0===t[o]||!n&&e.hasOwnProperty&&e.hasOwnProperty(o)&&!t.hasOwnProperty(o))&&(t[o]=e[o]);return!n&&e&&e.hasOwnProperty&&e.hasOwnProperty("toString")&&!t.hasOwnProperty("toString")&&(t.toString=e.toString),t},getParameterString:function(t){const e=[];for(const n in t){const o=t[n];if(null!=o&&"function"!=typeof o){let t;t=Array.isArray(o)||"[object Object]"===o.toString()?encodeURIComponent(JSON.stringify(o)):encodeURIComponent(o),e.push(encodeURIComponent(n)+"="+t)}}return e.join("&")},urlAppend:function(t,e){let n=t;if(e){0===e.indexOf("?")&&(e=e.substring(1));const o=(t+" ").split(/[?&]/);n+=" "===o.pop()?e:o.length?"&"+e:"?"+e}return n},urlPathAppend:function(t,e){let n=t;if(!e)return n;0===e.indexOf("/")&&(e=e.substring(1));const o=t.split("?");return o[0].indexOf("/",o[0].length-1)<0&&(o[0]+="/"),n=`${o[0]}${e}${o.length>1?`?${o[1]}`:""}`,n},DEFAULT_PRECISION:14,toFloat:function(t,e){return null==e&&(e=i.DEFAULT_PRECISION),"number"!=typeof t&&(t=parseFloat(t)),0===e?t:parseFloat(t.toPrecision(e))},rad:function(t){return t*Math.PI/180},getParameters:function(t){t=null==t?window.location.href:t;let n="";if(e.contains(t,"?")){const o=t.indexOf("?")+1,r=e.contains(t,"#")?t.indexOf("#"):t.length;n=t.substring(o,r)}const o={},r=n.split(/[&;]/);for(let t=0,e=r.length;t<e;++t){const e=r[t].split("=");if(e[0]){let t=e[0];try{t=decodeURIComponent(t)}catch(e){t=unescape(t)}let n=(e[1]||"").replace(/\+/g," ");try{n=decodeURIComponent(n)}catch(t){n=unescape(n)}n=n.split(","),1==n.length&&(n=n[0]),o[t]=n}}return o},lastSeqID:0,createUniqueID:function(t){return null==t&&(t="id_"),i.lastSeqID+=1,t+i.lastSeqID},normalizeScale:function(t){return t>1?1/t:t},getResolutionFromScale:function(t,e){let n;if(t){null==e&&(e="degrees");n=1/(i.normalizeScale(t)*l[e]*96)}return n},getScaleFromResolution:function(t,e){null==e&&(e="degrees");return t*l[e]*96},getBrowser:function(){return r},isSupportCanvas:s,supportCanvas:function(){return i.isSupportCanvas},isInTheSameDomain:function(t){if(!t)return!0;let e=t.indexOf("//");const n=document.location.toString();let o=n.indexOf("//");if(-1===e)return!0;{let r,s=r=t.substring(0,e);const i=n.substring(o+2);o=i.indexOf("/");const l=i.indexOf(":");let a=i.substring(0,o);const h=document.location.protocol;if(-1!==l||(a+=":"+("http:"===h.toLowerCase()?80:443)),h.toLowerCase()!==s.toLowerCase())return!1;s=t.substring(e+2);const u=s.indexOf(":");e=s.indexOf("/");let c,p=s.substring(0,e);-1!==u?c=s.substring(0,u):(c=s.substring(0,e),p+=":"+("http:"===r.toLowerCase()?80:443));if(c===document.domain&&p===a)return!0}return!1},calculateDpi:function(t,e,n,o,r){if(!t||!e||!n)return;const s=1e4,i=t.getWidth(),l=t.getHeight(),a=e.w,h=e.h;let u;if(r=r||6378137,"degree"===(o=o||"degrees").toLowerCase()||"degrees"===o.toLowerCase()||"dd"===o.toLowerCase()){const t=i/a,e=l/h;u=254/(t>e?t:e)/n/(2*Math.PI*r/360)/s}else{u=254/(i/a)/n/s}return u},toJSON:function(t){let e=t;if(null==e)return null;switch(e.constructor){case String:return e='"'+e.replace(/(["\\])/g,"\\$1")+'"',e=e.replace(/\n/g,"\\n"),e=e.replace(/\r/g,"\\r"),e=e.replace("<","&lt;"),e=e.replace(">","&gt;"),e=e.replace(/%/g,"%25"),e=e.replace(/&/g,"%26"),e;case Array:{let t="";for(let n=0,o=e.length;n<o;n++)t+=i.toJSON(e[n]),n!==e.length-1&&(t+=",");return"["+t+"]"}case Number:return isFinite(e)?String(e):null;case Boolean:return String(e);case Date:return"{'__type':\"System.DateTime\",'Year':"+e.getFullYear()+",'Month':"+(e.getMonth()+1)+",'Day':"+e.getDate()+",'Hour':"+e.getHours()+",'Minute':"+e.getMinutes()+",'Second':"+e.getSeconds()+",'Millisecond':"+e.getMilliseconds()+",'TimezoneOffset':"+e.getTimezoneOffset()+"}";default:if(null!=e.toJSON&&"function"==typeof e.toJSON)return e.toJSON();if("object"==typeof e){if(e.length){const t=[];for(let n=0,o=e.length;n<o;n++)t.push(i.toJSON(e[n]));return"["+t.join(",")+"]"}const t=[];for(const n in e)"function"!=typeof e[n]&&"CLASS_NAME"!==n&&"parent"!==n&&t.push("'"+n+"':"+i.toJSON(e[n]));return t.length>0?"{"+t.join(",")+"}":"{}"}return e.toString()}},getResolutionFromScaleDpi:function(t,e,n,o){let r=null;const s=1e4;return o=o||6378137,n=n||"",t>0&&e>0?(t=i.normalizeScale(t),"degree"===n.toLowerCase()||"degrees"===n.toLowerCase()||"dd"===n.toLowerCase()?(r=254/e/t/(2*Math.PI*o/360)/s,r):(r=254/e/t/s,r)):-1},getScaleFromResolutionDpi:function(t,e,n,o){let r=null;const s=1e4;return o=o||6378137,n=n||"",t>0&&e>0?"degree"===n.toLowerCase()||"degrees"===n.toLowerCase()||"dd"===n.toLowerCase()?(r=254/e/t/(2*Math.PI*o/360)/s,r):(r=254/e/t/s,r):-1},transformResult:function(t){return t.responseText&&"string"==typeof t.responseText&&(t=JSON.parse(t.responseText)),t},copyAttributes:function(t,e){if(t=t||{},e)for(const n in e){const o=e[n];void 0!==o&&"CLASS_NAME"!==n&&"function"!=typeof o&&(t[n]=o)}return t},copyAttributesWithClip:function(t,e,n){if(t=t||{},e)for(const o in e){let r=!1;if(n&&n.length)for(let t=0,e=n.length;t<e;t++)if(o===n[t]){r=!0;break}if(!0===r)continue;const s=e[o];void 0!==s&&"CLASS_NAME"!==o&&"function"!=typeof s&&(t[o]=s)}return t},cloneObject:function(t){if(null===t||"object"!=typeof t)return t;if(t instanceof Date){const e=new Date;return e.setTime(t.getTime()),e}if(t instanceof Array){return t.slice(0)}if(t instanceof Object){const e={};for(const n in t)t.hasOwnProperty(n)&&(e[n]=i.cloneObject(t[n]));return e}throw new Error("Unable to copy obj! Its type isn't supported.")},lineIntersection:function(t,e,n,r){let s,i,l=null;const a=(r.x-n.x)*(t.y-n.y)-(r.y-n.y)*(t.x-n.x),h=(e.x-t.x)*(t.y-n.y)-(e.y-t.y)*(t.x-n.x),u=(r.y-n.y)*(e.x-t.x)-(r.x-n.x)*(e.y-t.y);if(0!=u)s=a/u,i=h/u,l=s>=0&&i<=1&&s<=1&&i>=0?new o.Point(t.x+s*(e.x-t.x),t.y+s*(e.y-t.y)):"No Intersection";else if(0==a&&0==h){const o=Math.max(t.y,e.y),s=Math.min(t.y,e.y),i=Math.max(t.x,e.x),a=Math.min(t.x,e.x);l=(n.y>=s&&n.y<=o||r.y>=s&&r.y<=o)&&n.x>=a&&n.x<=i||r.x>=a&&r.x<=i?"Coincident":"Parallel"}else l="Parallel";return l},getTextBounds:function(t,e,n){document.body.appendChild(n),n.style.width="auto",n.style.height="auto",t.fontSize&&(n.style.fontSize=t.fontSize),t.fontFamily&&(n.style.fontFamily=t.fontFamily),t.fontWeight&&(n.style.fontWeight=t.fontWeight),n.style.position="relative",n.style.visibility="hidden",n.style.display="inline-block",n.innerHTML=e;const o=n.clientWidth,r=n.clientHeight;return document.body.removeChild(n),{textWidth:o,textHeight:r}},convertPath:function(t,e){return e?t.replace(/\{([\w-\.]+)\}/g,(t,n)=>{let o;return o=e.hasOwnProperty(n)?function(t){if(null==t||null==t)return"";if(t instanceof Date)return t.toJSON();if(function(t){if("string"!=typeof t&&"object"!=typeof t)return!1;try{const e=t.toString();return"[object Object]"===e||"[object Array]"===e}catch(t){return!1}}(t))return JSON.stringify(t);return t.toString()}(e[n]):t,encodeURIComponent(o)}):t}},l={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36};l.in=l.inches,l.degrees=l.dd,l.nmi=1852*l.m;i.extend(l,{Inch:l.inches,Meter:39.37,Foot:12,IFoot:11.999976,ClarkeFoot:11.999868327581488,SearsFoot:11.999955194477684,GoldCoastFoot:11.999964589846002,IInch:.9999979999999999,MicroInch:999998e-9,Mil:9.99998e-7,Centimeter:.3937,Kilometer:39370,Yard:36,SearsYard:35.99986558343306,IndianYard:35.99987015540864,IndianYd37:35.999740205100004,IndianYd62:35.999880755999996,IndianYd75:35.999868945,IndianFoot:11.9999567087,IndianFt37:11.9999134017,IndianFt62:11.999960252000001,IndianFt75:11.999956315,Mile:63360,IYard:35.999928,IMile:63359.87328,NautM:72913.24,"Lat-66":4367838.370169282,"Lat-83":4367954.152606599,Decimeter:3.9370000000000003,Millimeter:.03937,Dekameter:393.7,Decameter:393.7,Hectometer:3937,GermanMeter:39.370535294205006,CaGrid:39.359685060000004,ClarkeChain:791.991309620512,GunterChain:792.0000000000001,BenoitChain:791.9977268035781,SearsChain:791.9970428354235,ClarkeLink:7.91991309620512,GunterLink:7.920000000000001,BenoitLink:7.919977268035781,SearsLink:7.919970428354236,Rod:198.00000000000014,IntnlChain:791.998416,IntnlLink:7.91998416,Perch:198.00000000000014,Pole:198.00000000000014,Furlong:7919.999999999997,Rood:148.75036777426,CapeFoot:11.999868185255002,Brealey:14763.75,ModAmFt:12.000458400000001,Fathom:71.999856,"NautM-UK":72959.85408,"50kilometers":1968500,"150kilometers":5905500}),i.extend(l,{mm:l.Meter/1e3,cm:l.Meter/100,dm:100*l.Meter,km:1e3*l.Meter,kmi:l.nmi,fath:l.Fathom,ch:l.IntnlChain,link:l.IntnlLink,"us-in":l.inches,"us-ft":l.Foot,"us-yd":l.Yard,"us-ch":l.GunterChain,"us-mi":l.Mile,"ind-yd":l.IndianYd37,"ind-ft":l.IndianFt37,"ind-ch":791.9942845122}),l.degree=l.dd,l.meter=l.m,l.foot=l.ft,l.inch=l.inches,l.mile=l.mi,l.kilometer=l.km,l.yard=l.yd;class a{constructor(t,e,n){this.CLASS_NAME="SuperMap.Feature",this.layer=t,this.id=i.createUniqueID(this.CLASS_NAME+"_"),this.lonlat=e,this.data=null!=n?n:{}}destroy(){this.id=null,this.lonlat=null,this.data=null}}const h="Unknown",u="Insert",c="Update",p="Delete";class f extends a{constructor(t,e,n){super(null,null,e),this.fid=null,this.geometry=t||null,this.attributes={},e&&(this.attributes=i.extend(this.attributes,e)),this.bounds=null,this.state=null,this.style=n||null,this.url=null,this.lonlat=null,this.CLASS_NAME="SuperMap.Feature.Vector",f.style={default:{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"default",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},delete:{display:"none"}}}destroy(){this.layer&&(this.layer.removeFeatures(this),this.layer=null),this.geometry=null,super.destroy()}clone(){return new f(this.geometry?this.geometry.clone():null,this.attributes,this.style)}toState(t){if(t===c)switch(this.state){case h:case p:this.state=t}else if(t===u)if(this.state===h);else this.state=t;else if(t===p)switch(this.state){case u:case p:break;case h:case c:this.state=t}else t===h&&(this.state=t)}}class y{constructor(t,e){this.w=t?parseFloat(t):0,this.h=t?parseFloat(e):0,this.CLASS_NAME="SuperMap.Size"}toString(){return"w="+this.w+",h="+this.h}clone(){return new y(this.w,this.h)}equals(t){let e=!1;return null!=t&&(e=this.w===t.w&&this.h===t.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(t.w)&&isNaN(t.h)),e}destroy(){this.w=null,this.h=null}}class d{constructor(t,e,n){this.x=t?parseFloat(t):0,this.y=e?parseFloat(e):0,this.mode=n,this.CLASS_NAME="SuperMap.Pixel"}toString(){return"x="+this.x+",y="+this.y}clone(){return new d(this.x,this.y,this.mode)}equals(t){let e=!1;return null!=t&&(e=this.x==t.x&&this.y==t.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(t.x)&&isNaN(t.y)),e}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}add(t,e){if(null==t||null==e)throw new TypeError("Pixel.add cannot receive null values");return new d(this.x+t,this.y+e)}offset(t){let e=this.clone();return t&&(e=this.add(t.x,t.y)),e}destroy(){this.x=null,this.y=null,this.mode=null}}d.Mode={LeftTop:"lefttop",RightTop:"righttop",RightBottom:"rightbottom",LeftBottom:"leftbottom"};class m{constructor(t,e){i.isArray(t)&&(e=t[1],t=t[0]),this.lon=t?i.toFloat(t):0,this.lat=e?i.toFloat(e):0,this.CLASS_NAME="SuperMap.LonLat"}toString(){return"lon="+this.lon+",lat="+this.lat}toShortString(){return this.lon+","+this.lat}clone(){return new m(this.lon,this.lat)}add(t,e){if(null==t||null==e)throw new TypeError("LonLat.add cannot receive null values");return new m(this.lon+i.toFloat(t),this.lat+i.toFloat(e))}equals(t){let e=!1;return null!=t&&(e=this.lon===t.lon&&this.lat===t.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(t.lon)&&isNaN(t.lat)),e}wrapDateLine(t){const e=this.clone();if(t){for(;e.lon<t.left;)e.lon+=t.getWidth();for(;e.lon>t.right;)e.lon-=t.getWidth()}return e}destroy(){this.lon=null,this.lat=null}static fromString(t){const e=t.split(",");return new m(e[0],e[1])}static fromArray(t){const e=i.isArray(t),n=e&&t[0],o=e&&t[1];return new m(n,o)}}class g{constructor(t,e,n,o){i.isArray(t)&&(o=t[3],n=t[2],e=t[1],t=t[0]),this.left=null!=t?i.toFloat(t):this.left,this.bottom=null!=e?i.toFloat(e):this.bottom,this.right=null!=n?i.toFloat(n):this.right,this.top=null!=o?i.toFloat(o):this.top,this.centerLonLat=null,this.CLASS_NAME="SuperMap.Bounds"}clone(){return new g(this.left,this.bottom,this.right,this.top)}equals(t){let e=!1;return null!=t&&(e=this.left===t.left&&this.right===t.right&&this.top===t.top&&this.bottom===t.bottom),e}toString(){return[this.left,this.bottom,this.right,this.top].join(",")}toArray(t){return!0===t?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]}toBBOX(t,e){null==t&&(t=6);const n=Math.pow(10,t),o=Math.round(this.left*n)/n,r=Math.round(this.bottom*n)/n,s=Math.round(this.right*n)/n,i=Math.round(this.top*n)/n;return!0===e?r+","+o+","+i+","+s:o+","+r+","+s+","+i}getWidth(){return this.right-this.left}getHeight(){return this.top-this.bottom}getSize(){return new y(this.getWidth(),this.getHeight())}getCenterPixel(){return new d((this.left+this.right)/2,(this.bottom+this.top)/2)}getCenterLonLat(){return this.centerLonLat||(this.centerLonLat=new m((this.left+this.right)/2,(this.bottom+this.top)/2)),this.centerLonLat}scale(t,e){let n,o;t=t||1,null==e&&(e=this.getCenterLonLat()),"SuperMap.LonLat"===e.CLASS_NAME?(n=e.lon,o=e.lat):(n=e.x,o=e.y);const r=(this.left-n)*t+n,s=(this.bottom-o)*t+o,i=(this.right-n)*t+n,l=(this.top-o)*t+o;return new g(r,s,i,l)}add(t,e){if(null==t||null==e)throw new TypeError("Bounds.add cannot receive null values");return new g(this.left+t,this.bottom+e,this.right+t,this.top+e)}extend(t){let e=null;if(t){switch(t.CLASS_NAME){case"SuperMap.LonLat":e=new g(t.lon,t.lat,t.lon,t.lat);break;case"SuperMap.Geometry.Point":e=new g(t.x,t.y,t.x,t.y);break;case"SuperMap.Bounds":e=t}e&&(this.centerLonLat=null,(null==this.left||e.left<this.left)&&(this.left=e.left),(null==this.bottom||e.bottom<this.bottom)&&(this.bottom=e.bottom),(null==this.right||e.right>this.right)&&(this.right=e.right),(null==this.top||e.top>this.top)&&(this.top=e.top))}}containsLonLat(t,e){"boolean"==typeof e&&(e={inclusive:e}),e=e||{};let n=this.contains(t.lon,t.lat,e.inclusive);const o=e.worldBounds;if(o&&!n){const r=o.getWidth(),s=(o.left+o.right)/2,i=Math.round((t.lon-s)/r);n=this.containsLonLat({lon:t.lon-i*r,lat:t.lat},{inclusive:e.inclusive})}return n}containsPixel(t,e){return this.contains(t.x,t.y,e)}contains(t,e,n){if(null==n&&(n=!0),null==t||null==e)return!1;let o=!1;return o=n?t>=this.left&&t<=this.right&&e>=this.bottom&&e<=this.top:t>this.left&&t<this.right&&e>this.bottom&&e<this.top,o}intersectsBounds(t,e){let n;"boolean"==typeof e&&(e={inclusive:e}),(e=e||{}).worldBounds?(n=this.wrapDateLine(e.worldBounds),t=t.wrapDateLine(e.worldBounds)):n=this,null==e.inclusive&&(e.inclusive=!0);let o=!1;const r=n.left===t.right||n.right===t.left||n.top===t.bottom||n.bottom===t.top;if(e.inclusive||!r){const e=t.bottom>=n.bottom&&t.bottom<=n.top||n.bottom>=t.bottom&&n.bottom<=t.top,r=t.top>=n.bottom&&t.top<=n.top||n.top>t.bottom&&n.top<t.top,s=t.left>=n.left&&t.left<=n.right||n.left>=t.left&&n.left<=t.right,i=t.right>=n.left&&t.right<=n.right||n.right>=t.left&&n.right<=t.right;o=(e||r)&&(s||i)}if(e.worldBounds&&!o){const r=e.worldBounds,s=r.getWidth(),i=!r.containsBounds(n),l=!r.containsBounds(t);i&&!l?(t=t.add(-s,0),o=n.intersectsBounds(t,{inclusive:e.inclusive})):l&&!i&&(n=n.add(-s,0),o=t.intersectsBounds(n,{inclusive:e.inclusive}))}return o}containsBounds(t,e,n){null==e&&(e=!1),null==n&&(n=!0);const o=this.contains(t.left,t.bottom,n),r=this.contains(t.right,t.bottom,n),s=this.contains(t.left,t.top,n),i=this.contains(t.right,t.top,n);return e?o||r||s||i:o&&r&&s&&i}determineQuadrant(t){let e="";const n=this.getCenterLonLat();return e+=t.lat<n.lat?"b":"t",e+=t.lon<n.lon?"l":"r",e}wrapDateLine(t,e){const n=(e=e||{}).leftTolerance||0,o=e.rightTolerance||0;let r=this.clone();if(t){const e=t.getWidth();for(;r.left<t.left&&r.right-o<=t.left;)r=r.add(e,0);for(;r.left+n>=t.right&&r.right>t.right;)r=r.add(-e,0);const s=r.left+n;s<t.right&&s>t.left&&r.right-o>t.right&&(r=r.add(-e,0))}return r}toServerJSONObject(){return{rightTop:{x:this.right,y:this.top},leftBottom:{x:this.left,y:this.bottom},left:this.left,right:this.right,top:this.top,bottom:this.bottom}}destroy(){this.left=null,this.right=null,this.top=null,this.bottom=null,this.centerLonLat=null}static fromString(t,e){const n=t.split(",");return g.fromArray(n,e)}static fromArray(t,e){return!0===e?new g(t[1],t[0],t[3],t[2]):new g(t[0],t[1],t[2],t[3])}static fromSize(t){return new g(0,t.h,t.w,0)}static oppositeQuadrant(t){let e="";return e+="t"===t.charAt(0)?"b":"t",e+="l"===t.charAt(1)?"r":"l",e}}class x extends o{constructor(t){super(),this.components=[],this.componentTypes=null,null!=t&&this.addComponents(t),this.CLASS_NAME="SuperMap.Geometry.Collection",this.geometryType="Collection"}destroy(){this.components.length=0,this.components=null,super.destroy()}clone(){const t=new x;for(let e=0,n=this.components.length;e<n;e++)t.addComponent(this.components[e].clone());return i.applyDefaults(t,this),t}getComponentsString(){const t=[];for(let e=0,n=this.components.length;e<n;e++)t.push(this.components[e].toShortString());return t.join(",")}calculateBounds(){this.bounds=null;const t=new g,e=this.components;if(e)for(let n=0,o=e.length;n<o;n++)t.extend(e[n].getBounds());null!=t.left&&null!=t.bottom&&null!=t.right&&null!=t.top&&this.setBounds(t)}addComponents(t){i.isArray(t)||(t=[t]);for(let e=0,n=t.length;e<n;e++)this.addComponent(t[e])}addComponent(t,e){let n=!1;if(t&&(null==this.componentTypes||i.indexOf(this.componentTypes,t.CLASS_NAME)>-1)){if(null!=e&&e<this.components.length){const n=this.components.slice(0,e),o=this.components.slice(e,this.components.length);n.push(t),this.components=n.concat(o)}else this.components.push(t);t.parent=this,this.clearBounds(),n=!0}return n}removeComponents(t){let e=!1;i.isArray(t)||(t=[t]);for(let n=t.length-1;n>=0;--n)e=this.removeComponent(t[n])||e;return e}removeComponent(t){return i.removeItem(this.components,t),this.clearBounds(),!0}getArea(){let t=0;for(let e=0,n=this.components.length;e<n;e++)t+=this.components[e].getArea();return t}equals(t){let e=!0;if(t&&t.CLASS_NAME&&this.CLASS_NAME===t.CLASS_NAME)if(i.isArray(t.components)&&t.components.length===this.components.length){for(let n=0,o=this.components.length;n<o;++n)if(!this.components[n].equals(t.components[n])){e=!1;break}}else e=!1;else e=!1;return e}getVertices(t){const e=[];for(let n=0,o=this.components.length;n<o;++n)Array.prototype.push.apply(e,this.components[n].getVertices(t));return e}}class S{constructor(t){this.data=null,this.keepData=!1,i.extend(this,t),this.options=t,this.CLASS_NAME="SuperMap.Format"}destroy(){}read(t){}write(t){}}class w extends S{constructor(t){super(t),this.indent="    ",this.space=" ",this.newline="\n",this.level=0,this.pretty=!1,this.nativeJSON=!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify),this.CLASS_NAME="SuperMap.Format.JSON",this.serialize={object:function(t){if(null==t)return"null";if(t.constructor===Date)return this.serialize.date.apply(this,[t]);if(t.constructor===Array)return this.serialize.array.apply(this,[t]);let e,n,o,r=["{"];this.level+=1;let s=!1;for(e in t)t.hasOwnProperty(e)&&(n=this.write.apply(this,[e,this.pretty]),o=this.write.apply(this,[t[e],this.pretty]),null!=n&&null!=o&&(s&&r.push(","),r.push(this.writeNewline(),this.writeIndent(),n,":",this.writeSpace(),o),s=!0));return this.level-=1,r.push(this.writeNewline(),this.writeIndent(),"}"),r.join("")},array:function(t){let e,n=["["];this.level+=1;for(let o=0,r=t.length;o<r;++o)e=this.write.apply(this,[t[o],this.pretty]),null!=e&&(o>0&&n.push(","),n.push(this.writeNewline(),this.writeIndent(),e));return this.level-=1,n.push(this.writeNewline(),this.writeIndent(),"]"),n.join("")},string:function(t){let e={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(t)?'"'+t.replace(/([\x00-\x1f\\"])/g,function(t,n){let o=e[n];return o||(o=n.charCodeAt(),"\\u00"+Math.floor(o/16).toString(16)+(o%16).toString(16))})+'"':'"'+t+'"'},number:function(t){return isFinite(t)?String(t):"null"},boolean:function(t){return String(t)},date:function(t){function e(t){return t<10?"0"+t:t}return'"'+t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())+"T"+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())+'"'}}}read(t,e){let n;if(this.nativeJSON)try{n=JSON.parse(t,e)}catch(e){return{data:t}}return this.keepData&&(this.data=n),n}write(t,e){this.pretty=!!e;let n=null,o=typeof t;if(this.serialize[o])try{n=!this.pretty&&this.nativeJSON?JSON.stringify(t):this.serialize[o].apply(this,[t])}catch(t){}return n}writeIndent(){let t=[];if(this.pretty)for(let e=0;e<this.level;++e)t.push(this.indent);return t.join("")}writeNewline(){return this.pretty?this.newline:""}writeSpace(){return this.pretty?this.space:""}}class b extends o{constructor(t,e,n,o){super(t,e,n,o),this.x=parseFloat(t),this.y=parseFloat(e),this.tag=o||0==o?parseFloat(o):null,this.type=n||"Point",this.CLASS_NAME="SuperMap.Geometry.Point",this.geometryType="Point"}clone(t){return null==t&&(t=new b(this.x,this.y)),i.applyDefaults(t,this),t}calculateBounds(){this.bounds=new g(this.x,this.y,this.x,this.y)}equals(t){let e=!1;return null!=t&&(e=this.x===t.x&&this.y===t.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(t.x)&&isNaN(t.y)),e}move(t,e){this.x=this.x+t,this.y=this.y+e,this.clearBounds()}toShortString(){return this.x+", "+this.y}destroy(){this.x=null,this.y=null,this.tag=null,super.destroy()}getVertices(){return[this]}}class C extends x{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.Point"],this.CLASS_NAME="SuperMap.Geometry.MultiPoint",this.geometryType="MultiPoint"}addPoint(t,e){this.addComponent(t,e)}removePoint(t){this.removeComponent(t)}}class M extends C{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.Point","SuperMap.PointWithMeasure"],this.CLASS_NAME="SuperMap.Geometry.Curve",this.geometryType="Curve"}}class A extends M{constructor(t){super(t),this.CLASS_NAME="SuperMap.Geometry.LineString",this.geometryType="LineString"}removeComponent(t){const e=this.components&&this.components.length>2;return e&&super.removeComponent.apply(this,arguments),e}getSortedSegments(){const t=this.components.length-1,e=new Array(t);let n,o;for(let r=0;r<t;++r)n=this.components[r],o=this.components[r+1],n.x<o.x?e[r]={x1:n.x,y1:n.y,x2:o.x,y2:o.y}:e[r]={x1:o.x,y1:o.y,x2:n.x,y2:n.y};return e.sort(function(t,e){return t.x1-e.x1})}getVertices(t){let e;return e=!0===t?[this.components[0],this.components[this.components.length-1]]:!1===t?this.components.slice(1,this.components.length-1):this.components.slice(),e}static calculateCircle(t){if(t.length<3)return t;const e={},n=t[0],o=t[1],r=t[2];let s=0,i=0,l=!0,a=0,h=0,u=0;const c=[],p=(r.y-n.y)/(r.x-n.x),f=r.y-p*r.x;if(r.x!=n.x&&r.y!=n.y&&o.y==p*o.x+f||r.x==n.x&&o.x==n.x||r.y==n.y&&o.y==n.y||r.x==n.x&&r.y==n.y||r.x==o.x&&r.y==o.y||n.x==o.x&&n.y==o.y)c.push(n),c.push(o),c.push(r);else{const t=(o.x*o.x+o.y*o.y-(n.x*n.x+n.y*n.y))*(2*(r.y-n.y))-(r.x*r.x+r.y*r.y-(n.x*n.x+n.y*n.y))*(2*(o.y-n.y)),y=2*(o.x-n.x)*(r.x*r.x+r.y*r.y-(n.x*n.x+n.y*n.y))-2*(r.x-n.x)*(o.x*o.x+o.y*o.y-(n.x*n.x+n.y*n.y)),d=4*((o.x-n.x)*(r.y-n.y)-(r.x-n.x)*(o.y-n.y));e.x=t/d,e.y=y/d,s=Math.sqrt((n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y));let m=(2*s*s-((n.x-r.x)*(n.x-r.x)+(n.y-r.y)*(n.y-r.y)))/(2*s*s);m=m>=1?1:m,m=m<=-1?-1:m,u=180*Math.acos(m)/Math.PI,u=r.x==n.x?e.x>n.x&&o.x>n.x||e.x<n.x&&o.x<n.x?360-u:u:e.y>p*e.x+f&&o.y>p*o.x+f||e.y<p*e.x+f&&o.y<p*o.x+f?360-u:u,i=u/72,r.y!=n.y?r.x==n.x?r.y>n.y?o.x<n.x&&(l=!1):o.x>n.x&&(l=!1):r.x<n.x?o.y<p*o.x+f&&(l=!1):o.y>p*o.x+f&&(l=!1):r.x>n.x?o.y>n.y&&(l=!1):o.y<n.y&&(l=!1);const g=(n.y-e.y)/(n.x-e.x);let x=g>=0?180*Math.atan(g)/Math.PI:Math.abs(180*Math.atan(g)/Math.PI)+90;const S=Math.abs(e.y);n.y==S&&S==r.y&&n.x<r.x&&(x+=180);const w=n.y-e.y;c.push(n);for(let t=1;t<72;t++){a=i*t,h=x,l?w>=0?g>=0?h+=a:h=180-(h-90)+a:h=g>0?h-180+a:90-h+a:w>=0?g>=0?h-=a:h=180-(h-90)-a:h=g>=0?h-180-a:90-h-a,h=h*Math.PI/180;const n=e.x+s*Math.cos(h),o=e.y+s*Math.sin(h);c.push(new b(n,o))}c.push(r)}return c}static createLineEPS(t){let e=[];const n=t.length;if(n<2)return t;for(let o=0;o<n;){if("LTypeArc"==t[o].type){const r=A.createLineArc(e,o,n,t);e=r[0],o=r[1]}else e.push(t[o]),o++}return e}static createLineArc(t,e,n,o){if(0==e){const r=A.addPointEPS(o,e,n,"LTypeArc");Array.prototype.push.apply(t,r[0]),e=r[1]+1}else if(e==n-1){const n=[o[e-1],o[e]],r=A.calculateCircle(n);Array.prototype.push.apply(t,r),e++}else{const r=A.addPointEPS(o,e,n,"LTypeArc");t.pop(),Array.prototype.push.apply(t,r[0]),e=r[1]+1}return[t,e]}static addPointEPS(t,e,n,o){const r=[],s=e+1;let i;return 0==e?Array.prototype.push.apply(r,[t[e],t[e+1]]):e==n-1?Array.prototype.push.apply(r,[t[e-1],t[e]]):Array.prototype.push.apply(r,[t[e-1],t[e],t[e+1]]),"LTypeCurve"==o?i=A.calculatePointsFBZN(r):"LTypeArc"==o&&(i=A.calculateCircle(r)),[i,s]}}class N extends x{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.LineString"],this.CLASS_NAME="SuperMap.Geometry.MultiLineString",this.geometryType="MultiLineString"}}class L extends A{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.Point"],this.CLASS_NAME="SuperMap.Geometry.LinearRing",this.geometryType="LinearRing"}addComponent(t,e){let n=!1;const o=this.components.pop();null==e&&t.equals(o)||(n=super.addComponent.apply(this,arguments));const r=this.components[0];return super.addComponent.apply(this,[r]),n}removeComponent(t){const e=this.components&&this.components.length>3;if(e){this.components.pop(),super.removeComponent.apply(this,arguments);const t=this.components[0];super.addComponent.apply(this,[t])}return e}getArea(){let t=0;if(this.components&&this.components.length>2){let e=0;for(let t=0,n=this.components.length;t<n-1;t++){const n=this.components[t],o=this.components[t+1];e+=(n.x+o.x)*(o.y-n.y)}t=-e/2}return t}getVertices(t){return!0===t?[]:this.components.slice(0,this.components.length-1)}}class O extends x{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.LinearRing"],this.CLASS_NAME="SuperMap.Geometry.Polygon",this.geometryType="Polygon"}getArea(){let t=0;if(this.components&&this.components.length>0){t+=Math.abs(this.components[0].getArea());for(let e=1,n=this.components.length;e<n;e++)t-=Math.abs(this.components[e].getArea())}return t}}class v extends x{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.Polygon"],this.CLASS_NAME="SuperMap.Geometry.MultiPolygon",this.geometryType="MultiPolygon"}}const P="LINE",F="LINEM",E="POINT",I="REGION",G="POINTEPS",k="LINEEPS",T="REGIONEPS",D="GEOCOMPOUND";class B{constructor(t,e,n){this.red=t||0==t?t:255,this.green=e||0,this.blue=n||0,this.CLASS_NAME="SuperMap.ServerColor"}destroy(){const t=this;t.red=null,t.green=null,t.blue=null}static fromJson(t){if(!t)return;const e=new B;let n=255;null!==t.red&&(n=Number(t.red)),e.red=n;let o=0;null!==t.green&&(o=Number(t.green)),e.green=o;let r=0;return null!==t.blue&&(r=Number(t.blue)),e.blue=r,e}}class R{constructor(t){this.fillBackColor=new B(255,255,255),this.fillBackOpaque=!1,this.fillForeColor=new B(255,0,0),this.fillGradientMode=null,this.fillGradientAngle=0,this.fillGradientOffsetRatioX=0,this.fillGradientOffsetRatioY=0,this.fillOpaqueRate=100,this.fillSymbolID=0,this.lineColor=new B(0,0,0),this.lineSymbolID=0,this.lineWidth=1,this.markerAngle=0,this.markerSize=1,this.markerSymbolID=-1,t&&i.extend(this,t),this.CLASS_NAME="SuperMap.ServerStyle"}destroy(){const t=this;t.fillBackColor&&(t.fillBackColor.destroy(),t.fillBackColor=null),t.fillBackOpaque=null,t.fillForeColor&&(t.fillForeColor.destroy(),t.fillForeColor=null),t.fillGradientMode=null,t.fillGradientAngle=null,t.fillGradientOffsetRatioX=null,t.fillGradientOffsetRatioY=null,t.fillOpaqueRate=null,t.fillSymbolID=null,t.lineColor&&(t.lineColor.destroy(),t.lineColor=null),t.lineSymbolID=null,t.lineWidth=null,t.markerAngle=null,t.markerSize=null,t.markerSymbolID=null}toServerJSONObject(){let t={};return t=i.copyAttributes(t,this),t}static fromJson(t){if(t)return new R({fillBackColor:B.fromJson(t.fillBackColor),fillBackOpaque:t.fillBackOpaque,fillForeColor:B.fromJson(t.fillForeColor),fillGradientMode:t.fillGradientMode,fillGradientAngle:t.fillGradientAngle,fillGradientOffsetRatioX:t.fillGradientOffsetRatioX,fillGradientOffsetRatioY:t.fillGradientOffsetRatioY,fillOpaqueRate:t.fillOpaqueRate,fillSymbolID:t.fillSymbolID,lineColor:B.fromJson(t.lineColor),lineSymbolID:t.lineSymbolID,lineWidth:t.lineWidth,markerAngle:t.markerAngle,markerSize:t.markerSize,markerSymbolID:t.markerSymbolID})}}class _ extends b{constructor(t){super(t),this.measure=null,t&&i.extend(this,t),this.CLASS_NAME="SuperMap.PointWithMeasure"}equals(t){let e=!1;if(null!=t){const n=this.x===t.x&&this.y===t.y&&this.measure===t.measure,o=isNaN(this.x)&&isNaN(this.y)&&isNaN(this.measure),r=isNaN(t.x)&&isNaN(t.y)&&isNaN(t.measure);e=n||o&&r}return e}toJson(){let t="{";return null!=this.measure&&null!=this.measure&&(t+='"measure":'+this.measure+","),t+='"x":'+this.x+",",t+='"y":'+this.y,t+="}",t}destroy(){const t=this;t.measure=null,t.x=null,t.y=null}static fromJson(t){if(t)return new _({x:t.x,y:t.y,measure:t.measure})}}class J extends x{constructor(t,e){super(t,e),this.id=null,this.center=null,this.style=null,this.length=null,this.maxM=null,this.minM=null,this.parts=null,this.points=null,this.type=null,this.componentTypes=["SuperMap.Geometry.LinearRing","SuperMap.Geometry.LineString"],e&&i.extend(this,e),this.CLASS_NAME="SuperMap.Route",this.geometryType="LINEM"}toJson(){let t="{";if(null!=this.id&&null!=this.id&&(t+='"id":'+this.id+","),null!=this.center&&null!=this.center&&(t+='"center":'+this.center+","),null!=this.style&&null!=this.style&&(t+='"style":'+this.style+","),null!=this.length&&null!=this.length&&(t+='"length":'+this.length+","),null!=this.maxM&&null!=this.maxM&&(t+='"maxM":'+this.maxM+","),null!=this.minM&&null!=this.minM&&(t+='"minM":'+this.minM+","),null!=this.type&&null!=this.type&&(t+='"type":"'+this.type+'",'),null!=this.parts&&null!=this.parts){t+='"parts":['+this.parts[0];for(let e=1;e<this.parts.length;e++)t+=","+this.parts[e];t+="],"}if(null!=this.components&&this.components.length>0){t+='"points":[';for(let e=0,n=this.components.length;e<n;e++)for(let n=0,o=this.components[e].components.length;n<o;n++)t+=this.components[e].components[n].toJson()+",";t=t.replace(/,$/g,""),t+="]"}return t=t.replace(/,$/g,""),t+="}",t}destroy(){const t=this;t.id=null,t.center=null,t.style=null,t.length=null,t.maxM=null,t.minM=null,t.type=null,t.parts=null,t.components.length=0,t.components=null,t.componentTypes=null}static fromJson(t){if(!t)return;const e=t.parts||[],n=t.points||[],o=e.length,r=[];if(!(o>0))return null;for(let t=0,s=0,i=[];t<o;t++){for(let o=0;o<e[t];o++)i.push(_.fromJson(n[s+o]));s+=e[t],i[0].equals(i[e[t]-1])?r.push(new L(i)):r.push(new A(i)),i=[]}return new J(r,{id:t.id,center:t.center,style:t.style,length:t.length,maxM:t.maxM,minM:t.minM,type:t.type,parts:t.parts})}}class j{constructor(t){this.id=0,this.style=null,this.parts=null,this.points=null,this.type=null,this.prjCoordSys=null,t&&i.extend(this,t),this.CLASS_NAME="SuperMap.ServerGeometry"}destroy(){const t=this;t.id=null,t.style=null,t.parts=null,t.partTopo=null,t.points=null,t.type=null,t.prjCoordSys=null}toGeometry(){const t=this;switch(t.type.toUpperCase()){case E:return t.toGeoPoint();case P:return t.toGeoLine();case F:return t.toGeoLinem();case I:return t.toGeoRegion();case G:return t.toGeoPoint();case k:return t.toGeoLineEPS();case T:return t.toGeoRegionEPS();case D:return t.transformGeoCompound()}}toGeoPoint(){const t=this.parts||[],e=this.points||[],n=t.length;if(n>0){if(1===n)return new b(e[0].x,e[0].y);{const t=[];for(let o=0;o<n;o++)t.push(new b(e[o].x,e[o].y));return new C(t)}}return null}toGeoLine(){const t=this.parts||[],e=this.points||[],n=t.length;if(n>0){if(1===n){const n=[];for(let o=0;o<t[0];o++)n.push(new b(e[o].x,e[o].y));return n[0].equals(n[t[0]-1])?new L(n):new A(n)}{const o=[];for(let r=0;r<n;r++){const n=[];for(let o=0;o<t[r];o++)n.push(new b(e[o].x,e[o].y));o.push(new A(n)),e.splice(0,t[r])}return new N(o)}}return null}toGeoLineEPS(){const t=this.parts||[],e=this.points||[];let n,o,r,s,i;const l=t.length;if(l>0){if(1===l){for(n=0,r=[];n<t[0];n++)r.push(new b(e[n].x,e[n].y,e[n].type));return r[0].equals(r[t[0]-1])?(i=A.createLineEPS(r),new L(i)):(i=A.createLineEPS(r),new A(i))}for(n=0,s=[];n<l;n++){for(o=0,r=[];o<t[n];o++)r.push(new b(e[o].x,e[o].y));i=A.createLineEPS(r),s.push(new A(i)),e.splice(0,t[n])}return new N(s)}return null}toGeoLinem(){return J.fromJson(this)}toGeoRegion(){const t=this,e=t.parts||[],n=t.partTopo||[],o=t.points||[],r=e.length;if(r<=0)return null;let s=[],i=[];if(1==r){for(let t=0;t<o.length;t++)i.push(new b(o[t].x,o[t].y));return s.push(new O([new L(i)])),new v(s)}let l=[];const a=[],h=[],u=[],c=[];for(let t=0,s=0;t<r;t++){for(let n=0;n<e[t];n++)i.push(new b(o[s+n].x,o[s+n].y));s+=e[t];const r=new O([new L(i)]);i=[],h.push(r),0===n.length&&u.push(r.getBounds()),c.push(1),a.push(r.getArea())}if(0===n.length){j.bubbleSort(a,h,n,u);const t=[];for(let e=1;e<h.length;e++)for(let n=e-1;n>=0;n--)if(t[e]=-1,u[n].containsBounds(u[e])){c[e]=-1*c[n],c[e]<0&&(t[e]=n);break}for(let e=0;e<h.length;e++)c[e]>0?s.push(h[e]):(s[t[e]].components=s[t[e]].components.concat(h[e].components),s.push(""))}else{s=[];for(let t=0;t<h.length;t++)if(n[t]&&-1==n[t]?l=l.concat(h[t].components):(l.length>0&&s.length>0&&(s[s.length-1].components=s[s.length-1].components.concat(l),l=[]),s.push(h[t])),t==r-1){const t=s.length;if(t)s[t-1].components=s[t-1].components.concat(l);else for(let t=0,e=l.length;t<e;t++)s.push(new O(l))}}return new v(s)}toGeoRegionEPS(){const t=this,e=t.parts||[],n=t.partTopo||[],o=t.points||[],r=e.length;if(r<=0)return null;let s,i=[],l=[];if(1==r){for(let t=0;t<o.length;t++)l.push(new b(o[t].x,o[t].y));return s=A.createLineEPS(l),i.push(new O([new L(s)])),new v(i)}let a=[];const h=[],u=[],c=[],p=[];for(let t=0,i=0;t<r;t++){for(let n=0;n<e[t];n++)l.push(new b(o[i+n].x,o[i+n].y));i+=e[t],s=A.createLineEPS(l);const r=new O([new L(s)]);l=[],u.push(r),0===n.length&&c.push(r.getBounds()),p.push(1),h.push(r.getArea())}if(0===n.length){j.bubbleSort(h,u,n,c);const t=[];for(let e=1;e<u.length;e++)for(let n=e-1;n>=0;n--)if(t[e]=-1,c[n].containsBounds(c[e])){p[e]=-1*p[n],p[e]<0&&(t[e]=n);break}for(let e=0;e<u.length;e++)p[e]>0?i.push(u[e]):(i[t[e]].components=i[t[e]].components.concat(u[e].components),i.push(""))}else{i=[];for(let t=0;t<u.length;t++)if(n[t]&&-1==n[t]?a=a.concat(u[t].components):(a.length>0&&i.length>0&&(i[i.length-1].components=i[i.length-1].components.concat(a),a=[]),i.push(u[t])),t==r-1){const t=i.length;if(t)i[t-1].components=i[t-1].components.concat(a);else for(let t=0,e=a.length;t<e;t++)i.push(new O(a))}}return new v(i)}transformGeoCompound(){const t=this.geoParts||[],e=t.length;if(e<=0)return null;const n=[];for(let o=0;o<e;o++){const e=t[o];n.push(new j(e).toGeometry())}return new x(n)}static fromJson(t){if(t)return new j({id:t.id,style:R.fromJson(t.style),parts:t.parts,partTopo:t.partTopo,points:t.points,center:t.center,length:t.length,maxM:t.maxM,minM:t.minM,type:t.type})}static fromGeometry(t){if(!t)return;let e=0;const n=[],o=[];let r=null;const s=t.components,i=t.CLASS_NAME,l={epsgCode:t.SRID};if(isNaN(t.id)||(e=t.id),"SuperMap.Geometry.LinearRing"!=i&&"SuperMap.Geometry.LineString"!=i&&(t instanceof C||t instanceof N)){const t=s.length;for(let e=0;e<t;e++){const t=s[e].getVertices(),r=t.length;n.push(r);for(let e=0;e<r;e++)o.push(new b(t[e].x,t[e].y))}r="SuperMap.Geometry.MultiPoint"==i?E:P}else if(t instanceof v){const t=s.length;for(let e=0;e<t;e++){const t=s[e].components,r=t.length;for(let e=0;e<r;e++){const r=t[e].getVertices(),s=r.length+1;n.push(s);for(let t=0;t<s-1;t++)o.push(new b(r[t].x,r[t].y));o.push(new b(r[0].x,r[0].y))}}r=I}else if(t instanceof O){const t=s.length;for(let e=0;e<t;e++){const t=s[e].getVertices(),r=t.length+1;n.push(r);for(let e=0;e<r-1;e++)o.push(new b(t[e].x,t[e].y));o.push(new b(t[0].x,t[0].y))}r=I}else{const e=t.getVertices();let s=e.length;for(let t=0;t<s;t++)o.push(new b(e[t].x,e[t].y));t instanceof L&&(o.push(new b(e[0].x,e[0].y)),s++),n.push(s),r=t instanceof b?E:P}return new j({id:e,style:null,parts:n,points:o,type:r,prjCoordSys:l})}static IsClockWise(t){const e=t.length;if(e<3)return 0;let n=t[0].y*(t[e-1].x-t[1].x);t.push(t[0]);for(let o=1;o<e;o++)n+=t[o].y*(t[o-1].x-t[o+1].x);return.5*n}static bubbleSort(t,e,n,o){for(let r=0;r<t.length;r++)for(let s=0;s<t.length;s++)if(t[r]>t[s]){const i=t[s];t[s]=t[r],t[r]=i;const l=e[s];if(e[s]=e[r],e[r]=l,n&&n.length>0){const t=n[s];n[s]=n[r],n[r]=t}if(o&&o.length>0){const t=o[s];o[s]=o[r],o[r]=t}}}}class W extends w{constructor(t){super(t),this.ignoreExtraDims=!0,this.CLASS_NAME="SuperMap.Format.GeoJSON",this.parseCoords={point:function(t){return new b(t[0],t[1])},multipoint:function(t){const e=[];let n=null;for(let o=0,r=t.length;o<r;++o)n=this.parseCoords.point.apply(this,[t[o]]),e.push(n);return new C(e)},linestring:function(t){const e=[];let n=null;for(let o=0,r=t.length;o<r;++o)n=this.parseCoords.point.apply(this,[t[o]]),e.push(n);return new A(e)},multilinestring:function(t){const e=[];let n=null;for(let o=0,r=t.length;o<r;++o)n=this.parseCoords.linestring.apply(this,[t[o]]),e.push(n);return new N(e)},polygon:function(t){const e=[];let n,o;for(let r=0,s=t.length;r<s;++r){try{o=this.parseCoords.linestring.apply(this,[t[r]])}catch(t){throw t}n=new L(o.components),e.push(n)}return new O(e)},multipolygon:function(t){const e=[];let n=null;for(let o=0,r=t.length;o<r;++o){try{n=this.parseCoords.polygon.apply(this,[t[o]])}catch(t){throw t}e.push(n)}return new v(e)},box:function(t){return new O([new L([new b(t[0][0],t[0][1]),new b(t[1][0],t[0][1]),new b(t[1][0],t[1][1]),new b(t[0][0],t[1][1]),new b(t[0][0],t[0][1])])])}},this.extract={feature:function(t){const e=this.extract.geometry.apply(this,[t.geometry]),n={type:"Feature",properties:this.createAttributes(t),geometry:e};return t.geometry&&"TEXT"===t.geometry.type&&(n.properties.texts=t.geometry.texts,n.properties.textStyle=t.geometry.textStyle),t.fid&&(n.id=t.fid),t.ID&&(n.id=t.ID),n},geometry:function(t){if(null==t)return null;!t.parts&&t.points&&(t.parts=[t.points.length]);const e=t.hasOwnProperty("geometryType")?t:new j(t).toGeometry()||t;let n=e.geometryType||e.type;"LinearRing"===n&&(n="LineString"),"LINEM"===n&&(n="MultiLineString");const o=this.extract[n.toLowerCase()].apply(this,[e]);let r;return n="TEXT"===n?"Point":n,r="Collection"===n?{type:"GeometryCollection",geometries:o}:{type:n,coordinates:o},r},point:function(t){const e=[t.x,t.y];for(const n in t)"x"===n||"y"===n||null===t[n]||isNaN(t[n])||e.push(t[n]);return e},text:function(t){return[t.points[0].x,t.points[0].y]},multipoint:function(t){const e=[];for(let n=0,o=t.components.length;n<o;++n)e.push(this.extract.point.apply(this,[t.components[n]]));return e},linestring:function(t){const e=[];for(let n=0,o=t.components.length;n<o;++n)e.push(this.extract.point.apply(this,[t.components[n]]));return e},multilinestring:function(t){const e=[];for(let n=0,o=t.components.length;n<o;++n)e.push(this.extract.linestring.apply(this,[t.components[n]]));return e},polygon:function(t){const e=[];for(let n=0,o=t.components.length;n<o;++n)e.push(this.extract.linestring.apply(this,[t.components[n]]));return e},multipolygon:function(t){const e=[];for(let n=0,o=t.components.length;n<o;++n)e.push(this.extract.polygon.apply(this,[t.components[n]]));return e},collection:function(t){const e=t.components.length,n=new Array(e);for(let o=0;o<e;++o)n[o]=this.extract.geometry.apply(this,[t.components[o]]);return n}}}read(t,e,n){e=e||"FeatureCollection";let o=null,r=null;if(r="string"==typeof t?super.read(t,n):t,r){if("string"!=typeof r.type);else if(this.isValidType(r,e))switch(e){case"Geometry":try{o=this.parseGeometry(r)}catch(t){}break;case"Feature":try{o=this.parseFeature(r),o.type="Feature"}catch(t){}break;case"FeatureCollection":switch(o=[],r.type){case"Feature":try{o.push(this.parseFeature(r))}catch(t){o=null}break;case"FeatureCollection":for(let t=0,e=r.features.length;t<e;++t)try{o.push(this.parseFeature(r.features[t]))}catch(t){o=null}break;default:try{const t=this.parseGeometry(r);o.push(new f(t))}catch(t){o=null}}}}else;return o}write(t,e){return super.write(this.toGeoJSON(t),e)}fromGeoJSON(t,e,n){const o=this.read(t,e,n);return i.isArray(o)?o.map(t=>this._toiSevrerFeature(t)):this._toiSevrerFeature(o)}toGeoJSON(t){let e={type:null};if(i.isArray(t)){e.type="FeatureCollection";const o=t.length;e.features=new Array(o);for(let r=0;r<o;++r){const o=t[r];if(n(o)){const t={};t.geometry=o,e.features[r]=this.extract.feature.apply(this,[t])}else e.features[r]=this.extract.feature.apply(this,[o])}}else if(n(t)){const n={};n.geometry=t,e=this.extract.feature.apply(this,[n])}else e=this.extract.feature.apply(this,[t]);function n(t){return t.hasOwnProperty("parts")&&t.hasOwnProperty("points")||t.hasOwnProperty("geoParts")}return e}isValidType(t,e){let n=!1;switch(e){case"Geometry":-1==i.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],t.type)||(n=!0);break;case"FeatureCollection":n=!0;break;default:t.type==e&&(n=!0)}return n}parseFeature(t){let e;const n=t.properties?t.properties:{},o=t.geometry&&t.geometry.bbox||t.bbox;try{e=this.parseGeometry(t.geometry)}catch(t){throw t}const r=new f(e,n);return o&&(r.bounds=g.fromArray(o)),t.id&&(r.geometry.id=t.id,r.fid=t.id),r}parseGeometry(t){if(null==t)return null;let e;if("GeometryCollection"==t.type){const n=t.geometries.length,o=new Array(n);for(let e=0;e<n;++e)o[e]=this.parseGeometry([t.geometries[e]]);e=new x(o)}else try{e=this.parseCoords[t.type.toLowerCase()].apply(this,[t.coordinates])}catch(t){throw t}return e}createCRSObject(t){const e=t.layer.projection.toString();let n={};if(e.match(/epsg:/i)){const t=parseInt(e.substring(e.indexOf(":")+1));n=4326==t?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+t}}}return n}_toiSevrerFeature(t){const e=t.attributes,n=[],o=[];for(const t in e)n.push(t),o.push(e[t]);const r={fieldNames:n,fieldValues:o,geometry:j.fromGeometry(t.geometry)};return r.geometry.id=t.fid,r}createAttributes(t){if(!t)return null;const e={};!function(t,e){if(!t.hasOwnProperty("fieldNames")||!t.hasOwnProperty("fieldValues"))return;const n=t.fieldNames,o=t.fieldValues;for(const t in n)e[n[t]]=o[t]}(t,e);const n=["fieldNames","fieldValues","geometry","stringID","ID"];for(const o in t)n.indexOf(o)>-1||(e[o]=t[o]);return e}}t.toGeoJSON=function(t){return(new W).toGeoJSON(t)}});
